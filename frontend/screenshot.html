</html>

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }

        #select-box {
            position: absolute;
            border: 2px dashed #3498db;
            background-color: rgba(52, 152, 219, 0.3);
            pointer-events: none;
            z-index: 999;
            display: none;
        }
    </style>
    <title>Selectable Area</title>
</head>

<body>

    <script type="module" src="bindings_main.js"></script>
    <script src="/wails/ipc.js"></script>
    <script src="/wails/runtime.js"></script>
    <div id="select-box"></div>

    <script>
        let isDragging = false;
        let startX, startY, endX, endY;

        const selectBox = document.getElementById('select-box');

        document.addEventListener('mousedown', (e) => {
            startX = e.clientX * getDpiFactorX() + window.pageXOffset;
            startY = e.clientY * getDpiFactorY() + window.pageYOffset;
            isDragging = true;

            selectBox.style.width = '0';
            selectBox.style.height = '0';
            selectBox.style.left = startX + 'px';
            selectBox.style.top = startY + 'px';
            selectBox.style.display = 'block';
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;

            endX = e.clientX * getDpiFactorX() + window.pageXOffset;
            endY = e.clientY * getDpiFactorY() + window.pageYOffset;

            const width = endX - startX;
            const height = endY - startY;

            selectBox.style.width = width + 'px';
            selectBox.style.height = height + 'px';
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
            selectBox.style.display = 'none';

            // 获取选中区域的坐标信息
            const selectedArea = {
                startX: startX,
                startY: startY,
                endX: endX,
                endY: endY
            };
            window.go.main.App.CaptureSelectedScreen(startX, startY, endX, endY)
            console.log(selectedArea);
        });

        function getDpiFactorX() {
            // 计算横向DPI因子
            const dpi = window.screen.width / window.innerWidth;
            return dpi;
        }

        function getDpiFactorY() {
            // 计算纵向DPI因子
            const dpi = window.screen.height / window.innerHeight;
            return dpi;
        }
    </script>

</body>

</html>